pipeline {
    agent any
    stages {
        stage('Git Cloning') {
	        steps {
                echo 'Cloning..'
		        git branch: 'dev', url: 'https://github.com/ishunrzb09/jenkins_django.git'
           }
           
        }
        
        stage('Installing Requirment') {
	        steps {
                echo 'Installing Requirment..'
		        sh '''#!/bin/bash
		        source /opt/home_env/bin/activate
		        cd chakki
		        pip install -r requirments.txt
		        '''
           }
           
        }
        
        stage('check formatting') {
	        steps {
                echo 'checking formatting..'
                script {
                    sh '''#!/bin/bash
    		        source /opt/home_env/bin/activate
    		        cd chakki
    		        black --check .
    		        isort --atomic .
    		        '''
                }
           }
           
        }

        stage('check coverage') {
	        steps {
                echo 'checking coverage..'
                sh '''#!/bin/bash
    		        source /opt/home_env/bin/activate
    		        cd chakki
                    coverage run manage.py test -v 2 && coverage report --fail-under=85
    		        '''
           }
           
        }

        stage('check Vulnerability') {
	        steps {
                echo 'checking Vulnerability..'
                sh '''#!/bin/bash
    		        source /opt/home_env/bin/activate
    		        cd chakki
    		        safety check --key 66cf49f8-9e05fc27-956e21bf-2ca39b9d
    		        '''
           }
           
        }
        
        
    }
}
